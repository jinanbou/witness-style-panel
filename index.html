<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Witness Style Panel</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      background: #111;
      color: white;
      font-family: sans-serif;
      height: 100vh;
      box-sizing: border-box;
      overflow: hidden;
    }

    #container {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 600px;
      height: 100%;
      padding: 10px;
      box-sizing: border-box;
    }

    #video-area {
      width: 100%;
      height: 40vh;
      background-color: black;
      margin-bottom: 10px;
      position: relative;
    }

    #video {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    #panels {
      display: flex;
      flex-direction: column;
      width: 100%;
      gap: 10px;
      flex-grow: 1;
      overflow-y: auto;
    }

    canvas.panel {
      background-color: #222;
      touch-action: none;
      width: 100%;
      height: auto;
      border: 2px solid white;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="video-area">
      <video id="video" controls></video>
    </div>
    <div id="panels">
      <canvas class="panel" width="300" height="100"></canvas>
      <canvas class="panel" width="300" height="100"></canvas>
      <canvas class="panel" width="300" height="100"></canvas>
    </div>
  </div>

  <script>
    const video = document.getElementById("video");
    const panels = document.querySelectorAll("canvas.panel");

    const videos = [
      "video1.mp4",
      "video2.mp4",
      "video3.mp4"
    ];

    panels.forEach((canvas, index) => {
      const ctx = canvas.getContext("2d");

      const start = { x: 20, y: 50 };
      const end = { x: 280, y: 50 };
      ctx.strokeStyle = "#666";
      ctx.lineWidth = 4;
      ctx.beginPath();
      ctx.arc(start.x, start.y, 6, 0, Math.PI * 2);
      ctx.fillStyle = "#666";
      ctx.fill();
      ctx.moveTo(start.x, start.y);
      ctx.lineTo(end.x, end.y);
      ctx.stroke();

      let drawing = false;
      let hasDrawn = false;

      const clearCanvas = () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.strokeStyle = "#666";
        ctx.lineWidth = 4;
        ctx.beginPath();
        ctx.arc(start.x, start.y, 6, 0, Math.PI * 2);
        ctx.fillStyle = "#666";
        ctx.fill();
        ctx.moveTo(start.x, start.y);
        ctx.lineTo(end.x, end.y);
        ctx.stroke();
      };

      const drawPath = (x, y) => {
        ctx.strokeStyle = "#0f0";
        ctx.lineWidth = 4;
        ctx.lineTo(x, y);
        ctx.stroke();
      };

      const onDown = (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
        const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
        const dx = x - start.x;
        const dy = y - start.y;
        if (dx * dx + dy * dy < 100) {
          drawing = true;
          ctx.beginPath();
          ctx.moveTo(start.x, start.y);
        }
      };

      const onMove = (e) => {
        if (!drawing) return;
        const rect = canvas.getBoundingClientRect();
        const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
        const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
        drawPath(x, y);
      };

      const onUp = () => {
        if (drawing) {
          drawing = false;
          hasDrawn = true;
          panels.forEach((c) => {
            if (c !== canvas) {
              const ctx2 = c.getContext("2d");
              ctx2.clearRect(0, 0, c.width, c.height);
              ctx2.strokeStyle = "#666";
              ctx2.lineWidth = 4;
              ctx2.beginPath();
              ctx2.arc(20, 50, 6, 0, Math.PI * 2);
              ctx2.fillStyle = "#666";
              ctx2.fill();
              ctx2.moveTo(20, 50);
              ctx2.lineTo(280, 50);
              ctx2.stroke();
            }
          });
          video.src = videos[index];
          video.play();
        }
      };

      canvas.addEventListener("mousedown", onDown);
      canvas.addEventListener("mousemove", onMove);
      canvas.addEventListener("mouseup", onUp);
      canvas.addEventListener("mouseleave", onUp);

      canvas.addEventListener("touchstart", onDown);
      canvas.addEventListener("touchmove", onMove);
      canvas.addEventListener("touchend", onUp);
    });
  </script>
</body>
</html>
