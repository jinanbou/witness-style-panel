<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>線を引くパネル</title>
  <style>
    body {
      margin: 0;
      background: #111;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .container {
      display: flex;
      gap: 10px;
      padding: 10px;
    }

    .panel {
      position: relative;
      width: 30vw;
      max-width: 200px;
      aspect-ratio: 1;
      background-color: #222;
      background-size: cover;
      background-position: center;
      border: 2px solid #fff;
      border-radius: 8px;
      touch-action: none;
    }

    canvas {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="panel" data-image="https://via.placeholder.com/200x200?text=1"></div>
    <div class="panel" data-image="https://via.placeholder.com/200x200?text=2"></div>
    <div class="panel" data-image="https://via.placeholder.com/200x200?text=3"></div>
  </div>

  <script>
    document.querySelectorAll('.panel').forEach(panel => {
      const bg = panel.dataset.image;
      panel.style.backgroundImage = `url(${bg})`;

      const canvas = document.createElement('canvas');
      panel.appendChild(canvas);
      const ctx = canvas.getContext('2d');
      let drawing = false;
      let lastX, lastY;

      function resize() {
        canvas.width = panel.clientWidth;
        canvas.height = panel.clientHeight;

        // 薄いガイド線（グレー）
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
        ctx.lineWidth = 4;
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.lineTo(canvas.width, canvas.height);
        ctx.moveTo(canvas.width, 0);
        ctx.lineTo(0, canvas.height);
        ctx.stroke();
      }

      resize();
      window.addEventListener('resize', resize);

      function getPos(e) {
        if (e.touches) {
          const rect = canvas.getBoundingClientRect();
          return {
            x: e.touches[0].clientX - rect.left,
            y: e.touches[0].clientY - rect.top
          };
        } else {
          return { x: e.offsetX, y: e.offsetY };
        }
      }

      function startDraw(e) {
        e.preventDefault();
        drawing = true;
        const pos = getPos(e);
        lastX = pos.x;
        lastY = pos.y;
      }

      function draw(e) {
        if (!drawing) return;
        const pos = getPos(e);
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 4;
        ctx.lineCap = 'round';
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
        lastX = pos.x;
        lastY = pos.y;
      }

      function endDraw() {
        drawing = false;
      }

      canvas.addEventListener('mousedown', startDraw);
      canvas.addEventListener('mousemove', draw);
      canvas.addEventListener('mouseup', endDraw);
      canvas.addEventListener('mouseleave', endDraw);

      canvas.addEventListener('touchstart', startDraw, { passive: false });
      canvas.addEventListener('touchmove', draw, { passive: false });
      canvas.addEventListener('touchend', endDraw);
    });
  </script>
</body>
</html>
