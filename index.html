<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Witness Style Panel</title>
  <style>
    body {
      margin: 0;
      background: #222;
      color: white;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    #image-display {
      width: 100%;
      height: 300px;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #image-display img {
      max-width: 100%;
      max-height: 100%;
      display: none;
    }
    .panels {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 20px;
    }
    canvas {
      background: #444;
      touch-action: none;
      border: 2px solid #888;
    }
  </style>
</head>
<body>
  <h1>Witness Style Panel</h1>
  <div id="image-display">
    <img id="main-image" src="" alt="表示画像" />
  </div>
  <div class="panels">
    <canvas width="120" height="120" data-index="0"></canvas>
    <canvas width="120" height="120" data-index="1"></canvas>
    <canvas width="120" height="120" data-index="2"></canvas>
  </div>
  <script>
    const panels = document.querySelectorAll("canvas");
    const imageDisplay = document.getElementById("main-image");
    const imageSources = ["image1.jpeg", "image2.png", "image3.png"];

    panels.forEach((canvas, index) => {
      const ctx = canvas.getContext("2d");

      // 薄い線と始点の白丸
      const start = { x: 20, y: 100 };
      const end = { x: 100, y: 20 };
      ctx.strokeStyle = "#888";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(start.x, start.y);
      ctx.lineTo(end.x, end.y);
      ctx.stroke();
      ctx.fillStyle = "#fff";
      ctx.beginPath();
      ctx.arc(start.x, start.y, 6, 0, Math.PI * 2);
      ctx.fill();

      let drawing = false;

      function getPos(e) {
        const rect = canvas.getBoundingClientRect();
        if (e.touches) {
          return {
            x: e.touches[0].clientX - rect.left,
            y: e.touches[0].clientY - rect.top,
          };
        } else {
          return {
            x: e.offsetX,
            y: e.offsetY,
          };
        }
      }

      function startDraw(e) {
        const pos = getPos(e);
        if (
          Math.hypot(pos.x - start.x, pos.y - start.y) < 10
        ) {
          drawing = true;
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          // redraw guide line and circle
          ctx.strokeStyle = "#888";
          ctx.lineWidth = 2;
          ctx.beginPath();
          ctx.moveTo(start.x, start.y);
          ctx.lineTo(end.x, end.y);
          ctx.stroke();
          ctx.fillStyle = "#fff";
          ctx.beginPath();
          ctx.arc(start.x, start.y, 6, 0, Math.PI * 2);
          ctx.fill();

          ctx.strokeStyle = "#0f0";
          ctx.lineWidth = 4;
          ctx.beginPath();
          ctx.moveTo(pos.x, pos.y);
        }
      }

      function draw(e) {
        if (!drawing) return;
        const pos = getPos(e);
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
        e.preventDefault();
      }

      function endDraw() {
        if (!drawing) return;
        drawing = false;
        showImage(index);
      }

      canvas.addEventListener("mousedown", startDraw);
      canvas.addEventListener("mousemove", draw);
      canvas.addEventListener("mouseup", endDraw);
      canvas.addEventListener("mouseleave", () => (drawing = false));

      canvas.addEventListener("touchstart", startDraw);
      canvas.addEventListener("touchmove", draw);
      canvas.addEventListener("touchend", endDraw);
    });

    function showImage(index) {
      imageDisplay.src = imageSources[index];
      imageDisplay.style.display = "block";
    }
  </script>
</body>
</html>
